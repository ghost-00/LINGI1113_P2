                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 2.9.4 #5595 (Oct 23 2013) (Mac OS X ppc)
                              4 ; This file was generated Wed Oct 23 12:26:12 2013
                              5 ;--------------------------------------------------------
                              6 	.module _realloc
                              7 	.optsdcc -mgbz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _realloc
                             13 ;--------------------------------------------------------
                             14 ;  ram data
                             15 ;--------------------------------------------------------
                             16 	.area _DATA
                             17 ;--------------------------------------------------------
                             18 ; overlayable items in  ram 
                             19 ;--------------------------------------------------------
                             20 	.area _OVERLAY
                             21 ;--------------------------------------------------------
                             22 ; external initialized ram data
                             23 ;--------------------------------------------------------
                             24 ;--------------------------------------------------------
                             25 ; global & static initialisations
                             26 ;--------------------------------------------------------
                             27 	.area _HOME
                             28 	.area _GSINIT
                             29 	.area _GSFINAL
                             30 	.area _GSINIT
                             31 ;--------------------------------------------------------
                             32 ; Home
                             33 ;--------------------------------------------------------
                             34 	.area _HOME
                             35 	.area _HOME
                             36 ;--------------------------------------------------------
                             37 ; code
                             38 ;--------------------------------------------------------
                             39 	.area _CODE
                             40 ;../_realloc.c:76: void __xdata * realloc (void * p, size_t size)
                             41 ;	---------------------------------
                             42 ; Function realloc
                             43 ; ---------------------------------
   0000                      44 _realloc_start::
   0000                      45 _realloc:
   0000 E8 F6                46 	lda	sp,-10(sp)
                             47 ;../_realloc.c:134: }
   0002 F3                   48 	di
                             49 ;../_realloc.c:84: pthis = _sdcc_find_memheader(p);
   0003 F8 0C                50 	lda	hl,12(sp)
   0005 2A                   51 	ld	a,(hl+)
   0006 66                   52 	ld	h,(hl)
   0007 6F                   53 	ld	l,a
   0008 E5                   54 	push	hl
   0009 CDr00s00             55 	call	__sdcc_find_memheader
   000C E8 02                56 	lda	sp,2(sp)
   000E 42                   57 	ld	b,d
   000F 4B                   58 	ld	c,e
   0010 F8 08                59 	lda	hl,8(sp)
   0012 71                   60 	ld	(hl),c
   0013 23                   61 	inc	hl
   0014 70                   62 	ld	(hl),b
                             63 ;../_realloc.c:85: if (pthis)
   0015 2B                   64 	dec	hl
   0016 2A                   65 	ld	a,(hl+)
   0017 B6                   66 	or	a,(hl)
   0018 CArF9s01             67 	jp	Z,00114$
                             68 ;../_realloc.c:87: if (size > (0xFFFF-HEADER_SIZE))
   001B 3E F9                69 	ld	a,#0xF9
   001D F8 0E                70 	lda	hl,14(sp)
   001F 96                   71 	sub	a,(hl)
   0020 3E FF                72 	ld	a,#0xFF
   0022 23                   73 	inc	hl
   0023 9E                   74 	sbc	a,(hl)
   0024 D2r31s00             75 	jp	NC,00111$
                             76 ;../_realloc.c:89: ret = (void __xdata *) NULL; //To prevent overflow in next line
   0027 F8 04                77 	lda	hl,4(sp)
   0029 36 00                78 	ld	(hl),#0x00
   002B 23                   79 	inc	hl
   002C 36 00                80 	ld	(hl),#0x00
   002E C3r0Bs02             81 	jp	00115$
   0031                      82 00111$:
                             83 ;../_realloc.c:93: size += HEADER_SIZE; //We need a memory for header too
   0031 F8 0F                84 	lda	hl,15(sp)
   0033 2B                   85 	dec	hl
   0034 5E                   86 	ld	e,(hl)
   0035 23                   87 	inc	hl
   0036 56                   88 	ld	d,(hl)
   0037 21 06 00             89 	ld	hl,#0x0006
   003A 19                   90 	add	hl,de
   003B 7D                   91 	ld	a,l
   003C 54                   92 	ld	d,h
   003D F8 0E                93 	lda	hl,14(sp)
   003F 22                   94 	ld	(hl+),a
   0040 72                   95 	ld	(hl),d
                             96 ;../_realloc.c:95: if ((((unsigned int)pthis->next) - ((unsigned int)pthis)) >= size)
   0041 F8 09                97 	lda	hl,9(sp)
   0043 2B                   98 	dec	hl
   0044 5E                   99 	ld	e,(hl)
   0045 23                  100 	inc	hl
   0046 56                  101 	ld	d,(hl)
   0047 1A                  102 	ld	a,(de)
   0048 F8 02               103 	lda	hl,2(sp)
   004A 22                  104 	ld	(hl+),a
   004B 13                  105 	inc	de
   004C 1A                  106 	ld	a,(de)
   004D 32                  107 	ld	(hl-),a
   004E 7E                  108 	ld	a,(hl)
   004F 2B                  109 	dec	hl
   0050 2B                  110 	dec	hl
   0051 77                  111 	ld	(hl),a
   0052 F8 03               112 	lda	hl,3(sp)
   0054 7E                  113 	ld	a,(hl)
   0055 2B                  114 	dec	hl
   0056 2B                  115 	dec	hl
   0057 77                  116 	ld	(hl),a
   0058 F8 08               117 	lda	hl,8(sp)
   005A 4E                  118 	ld	c,(hl)
   005B 23                  119 	inc	hl
   005C 46                  120 	ld	b,(hl)
   005D F8 01               121 	lda	hl,1(sp)
   005F 2B                  122 	dec	hl
   0060 5E                  123 	ld	e,(hl)
   0061 23                  124 	inc	hl
   0062 56                  125 	ld	d,(hl)
   0063 7B                  126 	ld	a,e
   0064 91                  127 	sub	a,c
   0065 5F                  128 	ld	e,a
   0066 7A                  129 	ld	a,d
   0067 98                  130 	sbc	a,b
   0068 47                  131 	ld	b,a
   0069 4B                  132 	ld	c,e
   006A 79                  133 	ld	a,c
   006B F8 0E               134 	lda	hl,14(sp)
   006D 96                  135 	sub	a,(hl)
   006E 78                  136 	ld	a,b
   006F 23                  137 	inc	hl
   0070 9E                  138 	sbc	a,(hl)
   0071 DAr95s00            139 	jp	C,00108$
                            140 ;../_realloc.c:97: pthis->len = size;
   0074 F8 09               141 	lda	hl,9(sp)
   0076 2B                  142 	dec	hl
   0077 5E                  143 	ld	e,(hl)
   0078 23                  144 	inc	hl
   0079 56                  145 	ld	d,(hl)
   007A 21 04 00            146 	ld	hl,#0x0004
   007D 19                  147 	add	hl,de
   007E 4D                  148 	ld	c,l
   007F 44                  149 	ld	b,h
   0080 59                  150 	ld	e,c
   0081 50                  151 	ld	d,b
   0082 F8 0E               152 	lda	hl,14(sp)
   0084 7E                  153 	ld	a,(hl)
   0085 12                  154 	ld	(de),a
   0086 13                  155 	inc	de
   0087 23                  156 	inc	hl
   0088 7E                  157 	ld	a,(hl)
   0089 12                  158 	ld	(de),a
                            159 ;../_realloc.c:98: ret = p;
   008A F8 0C               160 	lda	hl,12(sp)
   008C 2A                  161 	ld	a,(hl+)
   008D 5E                  162 	ld	e,(hl)
   008E F8 04               163 	lda	hl,4(sp)
   0090 22                  164 	ld	(hl+),a
   0091 73                  165 	ld	(hl),e
   0092 C3r0Bs02            166 	jp	00115$
   0095                     167 00108$:
                            168 ;../_realloc.c:102: if ((_sdcc_prev_memheader) &&
   0095 21r00s00            169 	ld	hl,#__sdcc_prev_memheader
   0098 7E                  170 	ld	a,(hl)
   0099 21r01s00            171 	ld	hl,#__sdcc_prev_memheader + 1
   009C B6                  172 	or	a,(hl)
   009D CAr8Bs01            173 	jp	Z,00104$
                            174 ;../_realloc.c:103: ((((unsigned int)pthis->next) -
   00A0 F8 03               175 	lda	hl,3(sp)
   00A2 2B                  176 	dec	hl
   00A3 4E                  177 	ld	c,(hl)
   00A4 23                  178 	inc	hl
   00A5 46                  179 	ld	b,(hl)
   00A6 F8 00               180 	lda	hl,0(sp)
   00A8 71                  181 	ld	(hl),c
   00A9 23                  182 	inc	hl
   00AA 70                  183 	ld	(hl),b
                            184 ;../_realloc.c:104: ((unsigned int)_sdcc_prev_memheader) -
   00AB 21r00s00            185 	ld	hl,#__sdcc_prev_memheader
   00AE 4E                  186 	ld	c,(hl)
   00AF 21r01s00            187 	ld	hl,#__sdcc_prev_memheader + 1
   00B2 46                  188 	ld	b,(hl)
   00B3 F8 01               189 	lda	hl,1(sp)
   00B5 2B                  190 	dec	hl
   00B6 5E                  191 	ld	e,(hl)
   00B7 23                  192 	inc	hl
   00B8 56                  193 	ld	d,(hl)
   00B9 7B                  194 	ld	a,e
   00BA 91                  195 	sub	a,c
   00BB 5F                  196 	ld	e,a
   00BC 7A                  197 	ld	a,d
   00BD 98                  198 	sbc	a,b
   00BE 32                  199 	ld	(hl-),a
   00BF 73                  200 	ld	(hl),e
                            201 ;../_realloc.c:105: _sdcc_prev_memheader->len) >= size))
   00C0 21r01s00            202 	ld	hl,#__sdcc_prev_memheader + 1
   00C3 21r00s00            203 	ld	hl,#__sdcc_prev_memheader
   00C6 4E                  204 	ld	c,(hl)
   00C7 21r01s00            205 	ld	hl,#__sdcc_prev_memheader + 1
   00CA 46                  206 	ld	b,(hl)
   00CB 03                  207 	inc	bc
   00CC 03                  208 	inc	bc
   00CD 03                  209 	inc	bc
   00CE 03                  210 	inc	bc
   00CF 59                  211 	ld	e,c
   00D0 50                  212 	ld	d,b
   00D1 1A                  213 	ld	a,(de)
   00D2 4F                  214 	ld	c,a
   00D3 13                  215 	inc	de
   00D4 1A                  216 	ld	a,(de)
   00D5 47                  217 	ld	b,a
   00D6 F8 01               218 	lda	hl,1(sp)
   00D8 2B                  219 	dec	hl
   00D9 5E                  220 	ld	e,(hl)
   00DA 23                  221 	inc	hl
   00DB 56                  222 	ld	d,(hl)
   00DC 7B                  223 	ld	a,e
   00DD 91                  224 	sub	a,c
   00DE 5F                  225 	ld	e,a
   00DF 7A                  226 	ld	a,d
   00E0 98                  227 	sbc	a,b
   00E1 47                  228 	ld	b,a
   00E2 4B                  229 	ld	c,e
   00E3 79                  230 	ld	a,c
   00E4 F8 0E               231 	lda	hl,14(sp)
   00E6 96                  232 	sub	a,(hl)
   00E7 78                  233 	ld	a,b
   00E8 23                  234 	inc	hl
   00E9 9E                  235 	sbc	a,(hl)
   00EA DAr8Bs01            236 	jp	C,00104$
                            237 ;../_realloc.c:107: pnew = (MEMHEADER __xdata * )((char __xdata *)_sdcc_prev_memheader + _sdcc_prev_memheader->len);
   00ED 21r01s00            238 	ld	hl,#__sdcc_prev_memheader + 1
   00F0 21r00s00            239 	ld	hl,#__sdcc_prev_memheader
   00F3 4E                  240 	ld	c,(hl)
   00F4 21r01s00            241 	ld	hl,#__sdcc_prev_memheader + 1
   00F7 46                  242 	ld	b,(hl)
   00F8 03                  243 	inc	bc
   00F9 03                  244 	inc	bc
   00FA 03                  245 	inc	bc
   00FB 03                  246 	inc	bc
   00FC 59                  247 	ld	e,c
   00FD 50                  248 	ld	d,b
   00FE 1A                  249 	ld	a,(de)
   00FF 4F                  250 	ld	c,a
   0100 13                  251 	inc	de
   0101 1A                  252 	ld	a,(de)
   0102 47                  253 	ld	b,a
   0103 21r00s00            254 	ld	hl,#__sdcc_prev_memheader
   0106 7E                  255 	ld	a,(hl)
   0107 81                  256 	add	a,c
   0108 21r01s00            257 	ld	hl,#__sdcc_prev_memheader + 1
   010B 4F                  258 	ld	c,a
   010C 21r01s00            259 	ld	hl,#__sdcc_prev_memheader + 1
   010F 7E                  260 	ld	a,(hl)
   0110 88                  261 	adc	a,b
   0111 47                  262 	ld	b,a
   0112 F8 06               263 	lda	hl,6(sp)
   0114 71                  264 	ld	(hl),c
   0115 23                  265 	inc	hl
   0116 70                  266 	ld	(hl),b
                            267 ;../_realloc.c:108: _sdcc_prev_memheader->next = pnew;
   0117 21r01s00            268 	ld	hl,#__sdcc_prev_memheader + 1
   011A 21r00s00            269 	ld	hl,#__sdcc_prev_memheader
   011D 4E                  270 	ld	c,(hl)
   011E 21r01s00            271 	ld	hl,#__sdcc_prev_memheader + 1
   0121 46                  272 	ld	b,(hl)
   0122 59                  273 	ld	e,c
   0123 50                  274 	ld	d,b
   0124 F8 06               275 	lda	hl,6(sp)
   0126 7E                  276 	ld	a,(hl)
   0127 12                  277 	ld	(de),a
   0128 13                  278 	inc	de
   0129 23                  279 	inc	hl
   012A 7E                  280 	ld	a,(hl)
   012B 12                  281 	ld	(de),a
                            282 ;../_realloc.c:111: pthis->next->prev = pnew;
   012C F8 02               283 	lda	hl,2(sp)
   012E 4E                  284 	ld	c,(hl)
   012F 23                  285 	inc	hl
   0130 46                  286 	ld	b,(hl)
   0131 03                  287 	inc	bc
   0132 03                  288 	inc	bc
   0133 59                  289 	ld	e,c
   0134 50                  290 	ld	d,b
   0135 F8 06               291 	lda	hl,6(sp)
   0137 7E                  292 	ld	a,(hl)
   0138 12                  293 	ld	(de),a
   0139 13                  294 	inc	de
   013A 23                  295 	inc	hl
   013B 7E                  296 	ld	a,(hl)
   013C 12                  297 	ld	(de),a
                            298 ;../_realloc.c:114: memmove(pnew, pthis, pthis->len);
   013D 23                  299 	inc	hl
   013E 23                  300 	inc	hl
   013F 2B                  301 	dec	hl
   0140 5E                  302 	ld	e,(hl)
   0141 23                  303 	inc	hl
   0142 56                  304 	ld	d,(hl)
   0143 21 04 00            305 	ld	hl,#0x0004
   0146 19                  306 	add	hl,de
   0147 4D                  307 	ld	c,l
   0148 44                  308 	ld	b,h
   0149 59                  309 	ld	e,c
   014A 50                  310 	ld	d,b
   014B 1A                  311 	ld	a,(de)
   014C 4F                  312 	ld	c,a
   014D 13                  313 	inc	de
   014E 1A                  314 	ld	a,(de)
   014F 47                  315 	ld	b,a
   0150 C5                  316 	push	bc
   0151 F8 0A               317 	lda	hl,10(sp)
   0153 2A                  318 	ld	a,(hl+)
   0154 66                  319 	ld	h,(hl)
   0155 6F                  320 	ld	l,a
   0156 E5                  321 	push	hl
   0157 F8 0A               322 	lda	hl,10(sp)
   0159 2A                  323 	ld	a,(hl+)
   015A 66                  324 	ld	h,(hl)
   015B 6F                  325 	ld	l,a
   015C E5                  326 	push	hl
   015D CDr00s00            327 	call	_memmove
   0160 E8 06               328 	lda	sp,6(sp)
                            329 ;../_realloc.c:115: pnew->len = size;
   0162 F8 07               330 	lda	hl,7(sp)
   0164 2B                  331 	dec	hl
   0165 5E                  332 	ld	e,(hl)
   0166 23                  333 	inc	hl
   0167 56                  334 	ld	d,(hl)
   0168 21 04 00            335 	ld	hl,#0x0004
   016B 19                  336 	add	hl,de
   016C 4D                  337 	ld	c,l
   016D 44                  338 	ld	b,h
   016E 59                  339 	ld	e,c
   016F 50                  340 	ld	d,b
   0170 F8 0E               341 	lda	hl,14(sp)
   0172 7E                  342 	ld	a,(hl)
   0173 12                  343 	ld	(de),a
   0174 13                  344 	inc	de
   0175 23                  345 	inc	hl
   0176 7E                  346 	ld	a,(hl)
   0177 12                  347 	ld	(de),a
                            348 ;../_realloc.c:116: ret = MEM(pnew);
   0178 F8 07               349 	lda	hl,7(sp)
   017A 2B                  350 	dec	hl
   017B 5E                  351 	ld	e,(hl)
   017C 23                  352 	inc	hl
   017D 56                  353 	ld	d,(hl)
   017E 21 06 00            354 	ld	hl,#0x0006
   0181 19                  355 	add	hl,de
   0182 7D                  356 	ld	a,l
   0183 54                  357 	ld	d,h
   0184 F8 04               358 	lda	hl,4(sp)
   0186 22                  359 	ld	(hl+),a
   0187 72                  360 	ld	(hl),d
   0188 C3r0Bs02            361 	jp	00115$
   018B                     362 00104$:
                            363 ;../_realloc.c:120: ret = malloc(size - HEADER_SIZE);
   018B F8 0F               364 	lda	hl,15(sp)
   018D 2B                  365 	dec	hl
   018E 5E                  366 	ld	e,(hl)
   018F 23                  367 	inc	hl
   0190 56                  368 	ld	d,(hl)
   0191 21 06 00            369 	ld	hl,#0x0006
   0194 7B                  370 	ld	a,e
   0195 95                  371 	sub	a,l
   0196 5F                  372 	ld	e,a
   0197 7A                  373 	ld	a,d
   0198 9C                  374 	sbc	a,h
   0199 47                  375 	ld	b,a
   019A 4B                  376 	ld	c,e
   019B C5                  377 	push	bc
   019C CDr00s00            378 	call	_malloc
   019F E8 02               379 	lda	sp,2(sp)
   01A1 42                  380 	ld	b,d
   01A2 4B                  381 	ld	c,e
   01A3 F8 04               382 	lda	hl,4(sp)
   01A5 71                  383 	ld	(hl),c
   01A6 23                  384 	inc	hl
   01A7 70                  385 	ld	(hl),b
                            386 ;../_realloc.c:121: if (ret)
   01A8 2B                  387 	dec	hl
   01A9 2A                  388 	ld	a,(hl+)
   01AA B6                  389 	or	a,(hl)
   01AB CAr0Bs02            390 	jp	Z,00115$
                            391 ;../_realloc.c:123: memcpy(ret, MEM(pthis), pthis->len - HEADER_SIZE);
   01AE F8 09               392 	lda	hl,9(sp)
   01B0 2B                  393 	dec	hl
   01B1 5E                  394 	ld	e,(hl)
   01B2 23                  395 	inc	hl
   01B3 56                  396 	ld	d,(hl)
   01B4 21 04 00            397 	ld	hl,#0x0004
   01B7 19                  398 	add	hl,de
   01B8 4D                  399 	ld	c,l
   01B9 44                  400 	ld	b,h
   01BA 59                  401 	ld	e,c
   01BB 50                  402 	ld	d,b
   01BC 1A                  403 	ld	a,(de)
   01BD 4F                  404 	ld	c,a
   01BE 13                  405 	inc	de
   01BF 1A                  406 	ld	a,(de)
   01C0 47                  407 	ld	b,a
   01C1 11 06 00            408 	ld	de,#0x0006
   01C4 79                  409 	ld	a,c
   01C5 93                  410 	sub	a,e
   01C6 5F                  411 	ld	e,a
   01C7 78                  412 	ld	a,b
   01C8 9A                  413 	sbc	a,d
   01C9 F8 01               414 	lda	hl,1(sp)
   01CB 32                  415 	ld	(hl-),a
   01CC 73                  416 	ld	(hl),e
   01CD F8 09               417 	lda	hl,9(sp)
   01CF 2B                  418 	dec	hl
   01D0 5E                  419 	ld	e,(hl)
   01D1 23                  420 	inc	hl
   01D2 56                  421 	ld	d,(hl)
   01D3 21 06 00            422 	ld	hl,#0x0006
   01D6 19                  423 	add	hl,de
   01D7 4D                  424 	ld	c,l
   01D8 44                  425 	ld	b,h
   01D9 F8 00               426 	lda	hl,0(sp)
   01DB 2A                  427 	ld	a,(hl+)
   01DC 66                  428 	ld	h,(hl)
   01DD 6F                  429 	ld	l,a
   01DE E5                  430 	push	hl
   01DF C5                  431 	push	bc
   01E0 F8 08               432 	lda	hl,8(sp)
   01E2 2A                  433 	ld	a,(hl+)
   01E3 66                  434 	ld	h,(hl)
   01E4 6F                  435 	ld	l,a
   01E5 E5                  436 	push	hl
   01E6 CDr00s00            437 	call	_memcpy
   01E9 E8 06               438 	lda	sp,6(sp)
                            439 ;../_realloc.c:124: free(p);
   01EB F8 0C               440 	lda	hl,12(sp)
   01ED 2A                  441 	ld	a,(hl+)
   01EE 66                  442 	ld	h,(hl)
   01EF 6F                  443 	ld	l,a
   01F0 E5                  444 	push	hl
   01F1 CDr00s00            445 	call	_free
   01F4 E8 02               446 	lda	sp,2(sp)
   01F6 C3r0Bs02            447 	jp	00115$
   01F9                     448 00114$:
                            449 ;../_realloc.c:132: ret = malloc(size);
   01F9 F8 0E               450 	lda	hl,14(sp)
   01FB 2A                  451 	ld	a,(hl+)
   01FC 66                  452 	ld	h,(hl)
   01FD 6F                  453 	ld	l,a
   01FE E5                  454 	push	hl
   01FF CDr00s00            455 	call	_malloc
   0202 E8 02               456 	lda	sp,2(sp)
   0204 42                  457 	ld	b,d
   0205 4B                  458 	ld	c,e
   0206 F8 04               459 	lda	hl,4(sp)
   0208 71                  460 	ld	(hl),c
   0209 23                  461 	inc	hl
   020A 70                  462 	ld	(hl),b
   020B                     463 00115$:
   020B FB                  464 	ei
                            465 ;../_realloc.c:135: return ret;
   020C F8 05               466 	lda	hl,5(sp)
   020E 2B                  467 	dec	hl
   020F 5E                  468 	ld	e,(hl)
   0210 23                  469 	inc	hl
   0211 56                  470 	ld	d,(hl)
   0212                     471 00116$:
   0212 E8 0A               472 	lda	sp,10(sp)
   0214 C9                  473 	ret
   0215                     474 _realloc_end::
                            475 	.area _CODE
                            476 	.area _CABS
