                              1         ;; Generic crt0.s for a GBZ80
                              2         .globl  _main
                              3 
                              4         .area   _HEADER (ABS)
                              5         ;; Reset vector
   0000                       6         .org    0
   0000 C3r50s01              7         jp      init
                              8 
   0008                       9         .org    0x08
   0008 D9                   10         reti
   0010                      11         .org    0x10
   0010 D9                   12         reti
   0018                      13         .org    0x18
   0018 D9                   14         reti
   0020                      15         .org    0x20
   0020 D9                   16         reti
   0028                      17         .org    0x28
   0028 D9                   18         reti
   0030                      19         .org    0x30
   0030 D9                   20         reti
   0038                      21         .org    0x38
   0038 D9                   22         reti
                             23 
   0100                      24         .org    0x100
   0100 C3 50 01             25         jp      0x150
                             26 
   0150                      27         .org    0x150
   0150                      28 init:
   0150 F3                   29         di
                             30         ;; Stack at the top of memory.
   0151 31 FF DF             31         ld      sp,#0xdfff
                             32 
                             33         ;; Setup global data
   0154 CDr00s00             34         call    gsinit
                             35 
                             36         ;; Use _main instead of main to bypass sdcc's intelligence
   0157 CDr00s00             37         call    _main
   015A C3r04s00             38         jp      _exit
                             39 
                             40         ;; Ordering of segments for the linker.
                             41         .area   _HOME
                             42         .area   _CODE
                             43         .area   _GSINIT
                             44         .area   _GSFINAL
                             45 
                             46         .area   _DATA
                             47         .area   _BSS
                             48         .area   _HEAP
                             49 
                             50         .area   _CODE
   0000                      51 __clock::
   0000 3E 02                52         ld      a,#2
   0002 CF                   53         rst     0x08
   0003 C9                   54         ret
                             55 
   0004                      56 _exit::
                             57         ;; Exit - special code to the emulator
   0004 3E 00                58         ld      a,#0
   0006 CF                   59         rst     0x08
   0007                      60 1$:
   0007 76                   61         halt
   0008 18 FD                62         jr      1$
                             63 
                             64         .area   _GSINIT
   0000                      65 gsinit::
                             66 
                             67         .area   _GSFINAL
   0000 C9                   68         ret
