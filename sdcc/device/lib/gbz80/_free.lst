                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 2.9.4 #5595 (Oct 23 2013) (Mac OS X ppc)
                              4 ; This file was generated Wed Oct 23 12:26:12 2013
                              5 ;--------------------------------------------------------
                              6 	.module _free
                              7 	.optsdcc -mgbz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl __sdcc_find_memheader
                             13 	.globl __sdcc_prev_memheader
                             14 	.globl _free
                             15 ;--------------------------------------------------------
                             16 ;  ram data
                             17 ;--------------------------------------------------------
                             18 	.area _DATA
   0000                      19 __sdcc_prev_memheader::
   0000                      20 	.ds 2
                             21 ;--------------------------------------------------------
                             22 ; overlayable items in  ram 
                             23 ;--------------------------------------------------------
                             24 	.area _OVERLAY
                             25 ;--------------------------------------------------------
                             26 ; external initialized ram data
                             27 ;--------------------------------------------------------
                             28 ;--------------------------------------------------------
                             29 ; global & static initialisations
                             30 ;--------------------------------------------------------
                             31 	.area _HOME
                             32 	.area _GSINIT
                             33 	.area _GSFINAL
                             34 	.area _GSINIT
                             35 ;--------------------------------------------------------
                             36 ; Home
                             37 ;--------------------------------------------------------
                             38 	.area _HOME
                             39 	.area _HOME
                             40 ;--------------------------------------------------------
                             41 ; code
                             42 ;--------------------------------------------------------
                             43 	.area _CODE
                             44 ;../_free.c:54: _sdcc_find_memheader(void * p)
                             45 ;	---------------------------------
                             46 ; Function _sdcc_find_memheader
                             47 ; ---------------------------------
   0000                      48 __sdcc_find_memheader_start::
   0000                      49 __sdcc_find_memheader:
                             50 	
   0000 F5                   51 	push	af
                             52 ;../_free.c:57: if (!p)
   0001 F8 04                53 	lda	hl,4(sp)
   0003 2A                   54 	ld	a,(hl+)
   0004 B6                   55 	or	a,(hl)
   0005 C2r0Es00             56 	jp	NZ,00102$
                             57 ;../_free.c:58: return NULL;
   0008 11 00 00             58 	ld	de,#0x0000
   000B C3r38s00             59 	jp	00103$
   000E                      60 00102$:
                             61 ;../_free.c:59: pthis = (MEMHEADER * )((char *)  p - HEADER_SIZE); //to start of header
   000E F8 05                62 	lda	hl,5(sp)
   0010 2B                   63 	dec	hl
   0011 4E                   64 	ld	c,(hl)
   0012 23                   65 	inc	hl
   0013 46                   66 	ld	b,(hl)
   0014 11 06 00             67 	ld	de,#0x0006
   0017 79                   68 	ld	a,c
   0018 93                   69 	sub	a,e
   0019 5F                   70 	ld	e,a
   001A 78                   71 	ld	a,b
   001B 9A                   72 	sbc	a,d
   001C F8 01                73 	lda	hl,1(sp)
   001E 32                   74 	ld	(hl-),a
   001F 73                   75 	ld	(hl),e
                             76 ;../_free.c:60: _sdcc_prev_memheader = pthis->prev;
   0020 4E                   77 	ld	c,(hl)
   0021 23                   78 	inc	hl
   0022 46                   79 	ld	b,(hl)
   0023 03                   80 	inc	bc
   0024 03                   81 	inc	bc
   0025 59                   82 	ld	e,c
   0026 50                   83 	ld	d,b
   0027 1A                   84 	ld	a,(de)
   0028 21r00s00             85 	ld	hl,#__sdcc_prev_memheader
   002B 77                   86 	ld	(hl),a
   002C 13                   87 	inc	de
   002D 1A                   88 	ld	a,(de)
   002E 21r01s00             89 	ld	hl,#__sdcc_prev_memheader + 1
   0031 77                   90 	ld	(hl),a
                             91 ;../_free.c:62: return (pthis);
   0032 F8 01                92 	lda	hl,1(sp)
   0034 2B                   93 	dec	hl
   0035 5E                   94 	ld	e,(hl)
   0036 23                   95 	inc	hl
   0037 56                   96 	ld	d,(hl)
   0038                      97 00103$:
   0038 E8 02                98 	lda	sp,2(sp)
   003A C9                   99 	ret
   003B                     100 __sdcc_find_memheader_end::
                            101 ;../_free.c:66: free (void *p)
                            102 ;	---------------------------------
                            103 ; Function free
                            104 ; ---------------------------------
   003B                     105 _free_start::
   003B                     106 _free:
                            107 	
   003B F5                  108 	push	af
   003C F5                  109 	push	af
                            110 ;../_free.c:70: if ( p ) //For allocated pointers only!
   003D F8 06               111 	lda	hl,6(sp)
   003F 2A                  112 	ld	a,(hl+)
   0040 B6                  113 	or	a,(hl)
   0041 CArA8s00            114 	jp	Z,00108$
                            115 ;../_free.c:87: }
   0044 F3                  116 	di
                            117 ;../_free.c:73: pthis = (MEMHEADER * )((char *)  p - HEADER_SIZE); //to start of header
   0045 2B                  118 	dec	hl
   0046 4E                  119 	ld	c,(hl)
   0047 23                  120 	inc	hl
   0048 46                  121 	ld	b,(hl)
   0049 11 06 00            122 	ld	de,#0x0006
   004C 79                  123 	ld	a,c
   004D 93                  124 	sub	a,e
   004E 5F                  125 	ld	e,a
   004F 78                  126 	ld	a,b
   0050 9A                  127 	sbc	a,d
   0051 F8 01               128 	lda	hl,1(sp)
   0053 32                  129 	ld	(hl-),a
   0054 73                  130 	ld	(hl),e
                            131 ;../_free.c:74: if ( pthis->prev ) // For the regular header
   0055 4E                  132 	ld	c,(hl)
   0056 23                  133 	inc	hl
   0057 46                  134 	ld	b,(hl)
   0058 03                  135 	inc	bc
   0059 03                  136 	inc	bc
   005A 59                  137 	ld	e,c
   005B 50                  138 	ld	d,b
   005C 1A                  139 	ld	a,(de)
   005D 4F                  140 	ld	c,a
   005E 13                  141 	inc	de
   005F 1A                  142 	ld	a,(de)
   0060 47                  143 	ld	b,a
   0061 B1                  144 	or	a,c
   0062 CAr92s00            145 	jp	Z,00104$
                            146 ;../_free.c:76: prev_header = pthis->prev;
   0065 23                  147 	inc	hl
   0066 71                  148 	ld	(hl),c
   0067 23                  149 	inc	hl
   0068 70                  150 	ld	(hl),b
                            151 ;../_free.c:77: prev_header->next = pthis->next;
   0069 2B                  152 	dec	hl
   006A 2B                  153 	dec	hl
   006B 2B                  154 	dec	hl
   006C 5E                  155 	ld	e,(hl)
   006D 23                  156 	inc	hl
   006E 56                  157 	ld	d,(hl)
   006F 1A                  158 	ld	a,(de)
   0070 4F                  159 	ld	c,a
   0071 13                  160 	inc	de
   0072 1A                  161 	ld	a,(de)
   0073 47                  162 	ld	b,a
   0074 23                  163 	inc	hl
   0075 23                  164 	inc	hl
   0076 2B                  165 	dec	hl
   0077 5E                  166 	ld	e,(hl)
   0078 23                  167 	inc	hl
   0079 56                  168 	ld	d,(hl)
   007A 79                  169 	ld	a,c
   007B 12                  170 	ld	(de),a
   007C 13                  171 	inc	de
   007D 78                  172 	ld	a,b
   007E 12                  173 	ld	(de),a
                            174 ;../_free.c:78: if (pthis->next)
   007F 79                  175 	ld	a,c
   0080 B0                  176 	or	a,b
   0081 CArA7s00            177 	jp	Z,00105$
                            178 ;../_free.c:80: pthis->next->prev = prev_header;
   0084 03                  179 	inc	bc
   0085 03                  180 	inc	bc
   0086 59                  181 	ld	e,c
   0087 50                  182 	ld	d,b
   0088 2B                  183 	dec	hl
   0089 7E                  184 	ld	a,(hl)
   008A 12                  185 	ld	(de),a
   008B 13                  186 	inc	de
   008C 23                  187 	inc	hl
   008D 7E                  188 	ld	a,(hl)
   008E 12                  189 	ld	(de),a
   008F C3rA7s00            190 	jp	00105$
   0092                     191 00104$:
                            192 ;../_free.c:85: pthis->len = 0; //For the first header
   0092 F8 01               193 	lda	hl,1(sp)
   0094 2B                  194 	dec	hl
   0095 5E                  195 	ld	e,(hl)
   0096 23                  196 	inc	hl
   0097 56                  197 	ld	d,(hl)
   0098 21 04 00            198 	ld	hl,#0x0004
   009B 19                  199 	add	hl,de
   009C 4D                  200 	ld	c,l
   009D 44                  201 	ld	b,h
   009E 59                  202 	ld	e,c
   009F 50                  203 	ld	d,b
   00A0 3E 00               204 	ld	a,#0x00
   00A2 12                  205 	ld	(de),a
   00A3 13                  206 	inc	de
   00A4 3E 00               207 	ld	a,#0x00
   00A6 12                  208 	ld	(de),a
   00A7                     209 00105$:
   00A7 FB                  210 	ei
   00A8                     211 00108$:
   00A8 E8 04               212 	lda	sp,4(sp)
   00AA C9                  213 	ret
   00AB                     214 _free_end::
                            215 	.area _CODE
                            216 	.area _CABS
